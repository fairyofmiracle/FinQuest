<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  {% if mobile_view %}
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes">
  {% else %}
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {% endif %}
  {% load static %}
  <title>{% block title %}FinQuest{% endblock %}</title>
  <!-- –§–∞–≤–∏–∫–æ–Ω–∫–∞ –∏–∑ FontAwesome –∏–∫–æ–Ω–∫–∏ -->
  <style>
    .favicon {
      width: 16px;
      height: 16px;
      display: inline-block;
    }
  </style>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><circle cx='256' cy='256' r='200' fill='%236366f1' stroke='%234f46e5' stroke-width='8'/><circle cx='200' cy='200' r='25' fill='%23fbbf24' stroke='%23f59e0b' stroke-width='3'/><circle cx='312' cy='200' r='25' fill='%23fbbf24' stroke='%23f59e0b' stroke-width='3'/><circle cx='200' cy='312' r='25' fill='%23fbbf24' stroke='%23f59e0b' stroke-width='3'/><circle cx='312' cy='312' r='25' fill='%23fbbf24' stroke='%23f59e0b' stroke-width='3'/><circle cx='256' cy='256' r='30' fill='%23fbbf24' stroke='%23f59e0b' stroke-width='4'/><text x='256' y='265' text-anchor='middle' font-family='Arial' font-size='20' font-weight='bold' fill='%23d97706'>‚ÇΩ</text></svg>">
  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'css/inter-fonts.css' %}" rel="stylesheet">
  <link href="{% static 'css/fontawesome.min.css' %}" rel="stylesheet">
  <link href="{% static 'css/finquest.css' %}" rel="stylesheet">
  <link href="{% static 'css/finquest_tutorial_addon.css' %}" rel="stylesheet">
  {% if mobile_view %}
  <link href="{% static 'css/mobile.css' %}" rel="stylesheet">
  <link href="{% static 'css/mobile-app.css' %}" rel="stylesheet">
  <link href="{% static 'css/mobile-fixes.css' %}" rel="stylesheet">
  <!-- PWA Manifest -->
  <link rel="manifest" href="{% static 'manifest.json' %}">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="FinQuest">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#667eea">
  {% endif %}
  <style>
    body { padding-bottom: 0; }
    .btn-lg { width: 100%; margin: 8px 0; }
    
    /* Footer Styles */
    .site-footer {
      background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
      padding: 3rem 0 1.5rem;
      margin-top: 5rem;
      border-top: 3px solid rgba(102, 126, 234, 0.3);
    }
    
    .footer-title {
      color: #667eea;
      font-weight: 700;
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }
    
    .footer-text {
      color: #d1d5db;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    
    .footer-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .footer-list li {
      color: #d1d5db;
      padding: 0.5rem 0;
      font-size: 0.95rem;
    }
    
    .footer-list li i {
      color: #667eea;
    }
    
    .social-links {
      display: flex;
      gap: 1rem;
    }
    
    .social-link {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(102, 126, 234, 0.1);
      border-radius: 50%;
      color: #9ca3af;
      text-decoration: none;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }
    
    .social-link:hover {
      background: linear-gradient(135deg, #667eea, #764ba2);
      transform: translateY(-3px);
      color: white;
    }
    
    .footer-bottom {
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: #9ca3af;
      font-size: 0.9rem;
    }
    
    /* –ö–Ω–æ–ø–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –ø–µ—Ä–µ–ª–∏–≤–æ–º */
    .btn-register {
      background: linear-gradient(45deg, #10b981, #059669, #047857, #059669, #10b981);
      background-size: 200% 200%;
      border: none;
      color: white !important;
      animation: gradientShift 3s ease infinite;
    }
    
    .btn-register:hover {
      background: linear-gradient(45deg, #10b981, #059669, #047857, #059669, #10b981);
      background-size: 200% 200%;
      color: white !important;
      transform: translateY(-2px);
    }
    
    .btn-register:active,
    .btn-register:focus,
    .btn-register:visited {
      color: white !important;
      background: linear-gradient(45deg, #10b981, #059669, #047857, #059669, #10b981);
      background-size: 200% 200%;
      border: none;
      outline: none;
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π */
    .achievement-modal-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 20px;
    }
    
    .achievement-celebration {
      color: white;
    }
    
    .achievement-icon-large {
      font-size: 4rem;
      color: #ffd700;
      animation: bounce 1s infinite alternate;
    }
    
    .achievement-title {
      font-size: 2rem;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .achievement-description {
      font-size: 1.1rem;
      opacity: 0.9;
    }
    
    .achievement-rarity-badge {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.9rem;
    }
    
    .rarity-common { background: #6c757d; }
    .rarity-uncommon { background: #28a745; }
    .rarity-rare { background: #007bff; }
    .rarity-legendary { background: #ffc107; color: #000; }
    
    @keyframes bounce {
      0% { transform: translateY(0); }
      100% { transform: translateY(-20px); }
    }
    
    /* –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ */
    #confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }
    
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background: #ff6b6b;
      animation: confetti-fall 3s linear infinite;
    }
    
    .confetti:nth-child(2n) { background: #4ecdc4; }
    .confetti:nth-child(3n) { background: #45b7d1; }
    .confetti:nth-child(4n) { background: #96ceb4; }
    .confetti:nth-child(5n) { background: #feca57; }
    .confetti:nth-child(6n) { background: #ff9ff3; }
    
    @keyframes confetti-fall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
    
    
    /* –ú–æ–±–∏–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ - —Å—Ç–∏–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ mobile-fixes.css */
    
    body.mobile-view .mobile-menu-toggle {
      flex-shrink: 0;
      margin-left: auto;
    }
    
    body.mobile-view .navbar .container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    /* –ë–∞–Ω–Ω–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA */
    .install-pwa-banner {
      position: fixed;
      bottom: 80px;
      left: 16px;
      right: 16px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 1rem;
      border-radius: 16px;
      display: none;
      z-index: 1020;
      animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
      from {
        transform: translateY(100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .install-pwa-banner.show {
      display: block;
    }
    
    .install-pwa-content {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .install-pwa-icon {
      font-size: 2rem;
      flex-shrink: 0;
    }
    
    .install-pwa-text {
      flex: 1;
    }
    
    .install-pwa-title {
      font-size: 0.95rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }
    
    .install-pwa-description {
      font-size: 0.8rem;
      opacity: 0.9;
      margin: 0;
    }
    
    .install-pwa-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }
    
    .install-pwa-btn {
      flex: 1;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .install-pwa-btn-primary {
      background: white;
      color: #667eea;
    }
    
    .install-pwa-btn-primary:active {
      transform: scale(0.95);
    }
    
    .install-pwa-btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }
    
    .install-pwa-btn-secondary:active {
      transform: scale(0.95);
    }
    
    .install-pwa-close {
      position: absolute;
      top: 8px;
      right: 8px;
      background: transparent;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      padding: 4px;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s ease;
    }
    
    .install-pwa-close:active {
      background: rgba(255, 255, 255, 0.2);
    }
  </style>
  <script src="{% static 'js/finquest.js' %}" defer></script>
  <script src="{% static 'js/tutorial.js' %}" defer></script>
  {% if mobile_view %}
  <script src="{% static 'js/mobile-app.js' %}" defer></script>
  {% endif %}
</head>
<body{% if mobile_view %} class="mobile-view"{% endif %}>
  <nav class="navbar navbar-expand-lg gaming-navbar">
    <div class="container">
      {% if mobile_view %}
        <!-- –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
        <h1 class="mobile-page-title">{% block page_title %}FinQuest{% endblock %}</h1>
        {% if user.is_authenticated %}
          <button class="btn btn-sm btn-outline-light mobile-menu-toggle" onclick="toggleMobileMenu()" type="button">
            <i class="fa-solid fa-bars"></i>
          </button>
        {% else %}
          <div class="d-flex align-items-center gap-2">
            <a href="{% url 'login' %}" class="btn btn-sm btn-primary" id="loginBtn">–í–æ–π—Ç–∏</a>
            <a href="{% url 'register' %}" class="btn btn-sm btn-register" id="registerBtn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
          </div>
        {% endif %}
      {% else %}
        <!-- –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
        <a class="navbar-brand" href="{% url 'dashboard' %}">
          <i class="fa-solid fa-money-bill-trend-up me-2"></i>FinQuest
        </a>
        <!-- –û–±—ã—á–Ω–æ–µ –º–µ–Ω—é –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ -->
        {% if user.is_authenticated %}
          <div class="d-flex align-items-center gap-2">
            <a href="{% url 'toggle_mobile_view' %}" class="btn btn-sm btn-outline-light" title="{% if mobile_view %}–û—Ç–∫–ª—é—á–∏—Ç—å –º–æ–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é{% else %}–í–∫–ª—é—á–∏—Ç—å –º–æ–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é{% endif %}">
              <i class="fa-solid {% if mobile_view %}fa-desktop{% else %}fa-mobile-screen-button{% endif %}"></i>
            </a>
            <button class="btn btn-sm btn-outline-light" onclick="toggleTheme()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
              <i class="fa-solid fa-moon" id="theme-icon"></i>
            </button>
            <a href="{% url 'media' %}" class="btn btn-outline-light">
              <i class="fa-solid fa-newspaper me-2"></i>–°—Ç–∞—Ç—å–∏
            </a>
            <div class="position-relative" style="display: inline-block;">
              <a href="{% url 'notifications_list' %}" class="btn btn-outline-light">
                <i class="fa-regular fa-bell me-2" style="color: white; font-size: 16px;"></i>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
              </a>
              {% if unread_notifications_count > 0 %}
                <span class="notification-badge" style="position: absolute; top: -8px; right: -8px; z-index: 9999; background: #ef4444 !important; color: white !important; border-radius: 50% !important; width: 22px !important; height: 22px !important; display: flex !important; align-items: center !important; justify-content: center !important; font-size: 0.7rem !important; font-weight: bold !important; padding: 0 !important; box-shadow: 0 2px 6px rgba(239, 68, 68, 0.5) !important; min-width: 22px !important;">
                  {{ unread_notifications_count }}
                </span>
              {% endif %}
            </div>
            <a href="{% url 'profile' %}" class="btn btn-outline-light">
              <i class="fa-regular fa-user me-2"></i>–ü—Ä–æ—Ñ–∏–ª—å
            </a>
            <form method="post" action="{% url 'logout' %}" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-danger">
                <i class="fa-solid fa-sign-out-alt me-1"></i>–í—ã–π—Ç–∏
              </button>
            </form>
          </div>
        {% else %}
          <div class="d-flex align-items-center gap-2">
            <a href="{% url 'login' %}" class="btn btn-sm btn-primary" id="loginBtn">–í–æ–π—Ç–∏</a>
            <a href="{% url 'register' %}" class="btn btn-sm btn-register" id="registerBtn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
          </div>
        {% endif %}
      {% endif %}
    </div>
  </nav>

  <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ –±–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
  {% if mobile_view and user.is_authenticated %}
  <div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="toggleMobileMenu()"></div>
  <div class="mobile-menu" id="mobileMenu">
    <div class="mobile-menu-header">
      <div class="mobile-menu-user">
        {% if user.get_avatar_display %}
          <img src="{{ user.get_avatar_display }}" alt="Avatar" class="mobile-menu-avatar">
        {% else %}
          <div class="mobile-menu-avatar-placeholder">
            <i class="fa-solid fa-user"></i>
          </div>
        {% endif %}
        <div class="mobile-menu-user-info">
          <div class="mobile-menu-username">{{ user.username }}</div>
          <div class="mobile-menu-user-level">–£—Ä–æ–≤–µ–Ω—å {{ user.level }}</div>
        </div>
      </div>
      <button class="mobile-menu-close" onclick="toggleMobileMenu()">
        <i class="fa-solid fa-times"></i>
      </button>
    </div>
    <div class="mobile-menu-body">
      <a href="{% url 'media' %}" class="mobile-menu-item" onclick="toggleMobileMenu()">
        <i class="fa-solid fa-newspaper"></i>
        <span>–°—Ç–∞—Ç—å–∏</span>
      </a>
      <a href="{% url 'notifications_list' %}" class="mobile-menu-item" onclick="toggleMobileMenu()">
        <i class="fa-regular fa-bell"></i>
        <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
        {% if unread_notifications_count > 0 %}
          <span class="mobile-menu-badge">{{ unread_notifications_count }}</span>
        {% endif %}
      </a>
      <a href="{% url 'dashboard' %}" class="mobile-menu-item" onclick="toggleMobileMenu()">
        <i class="fa-solid fa-home"></i>
        <span>–ì–ª–∞–≤–Ω–∞—è</span>
      </a>
      <div class="mobile-menu-divider"></div>
      <a href="{% url 'settings' %}" class="mobile-menu-item" onclick="toggleMobileMenu()">
        <i class="fa-solid fa-cog"></i>
        <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
      </a>
      <div class="mobile-menu-divider"></div>
      <a href="{% url 'mobile_achievements' %}" class="mobile-menu-item" onclick="toggleMobileMenu()">
        <i class="fa-solid fa-trophy"></i>
        <span>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
        {% if mobile_achievements_count > 0 %}
          <span class="mobile-menu-badge">{{ mobile_achievements_count }}</span>
        {% endif %}
      </a>
      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
      <div class="mobile-menu-item mobile-menu-theme-toggle" onclick="toggleTheme(); updateMobileThemeToggle();">
        <i class="fa-solid fa-moon" id="mobile-theme-icon"></i>
        <span>–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</span>
        <label class="mobile-theme-switch">
          <input type="checkbox" id="mobile-theme-toggle" onchange="toggleTheme(); updateMobileThemeToggle();">
          <span class="mobile-theme-slider"></span>
        </label>
      </div>
      <div class="mobile-menu-divider"></div>
      <button id="installPWAMenuBtn" class="mobile-menu-item" onclick="installPWAFromMenu()" style="display: none;">
        <i class="fa-solid fa-download"></i>
        <span>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</span>
      </button>
      <a href="{% url 'toggle_mobile_view' %}" class="mobile-menu-item" onclick="toggleMobileMenu()">
        <i class="fa-solid fa-desktop"></i>
        <span>–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ Desktop</span>
      </a>
      <form method="post" action="{% url 'logout' %}" style="margin: 0;">
        {% csrf_token %}
        <button type="submit" class="mobile-menu-item mobile-menu-logout">
          <i class="fa-solid fa-sign-out-alt"></i>
          <span>–í—ã–π—Ç–∏</span>
        </button>
      </form>
    </div>
  </div>
  {% endif %}

  <div class="container mt-3">
    {% block content %}{% endblock %}
  </div>
  
  <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ -->
  {% if mobile_view %}
    {% include 'includes/bottom_nav.html' %}
    
    <!-- –ë–∞–Ω–Ω–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA -->
    <div id="installPWABanner" class="install-pwa-banner">
      <button class="install-pwa-close" onclick="closeInstallBanner()">
        <i class="fa-solid fa-times"></i>
      </button>
      <div class="install-pwa-content">
        <div class="install-pwa-icon">
          üì±
        </div>
        <div class="install-pwa-text">
          <div class="install-pwa-title">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
          <p class="install-pwa-description">–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –±–µ–∑ –±—Ä–∞—É–∑–µ—Ä–∞</p>
        </div>
      </div>
      <div class="install-pwa-actions">
        <button class="install-pwa-btn install-pwa-btn-primary" onclick="installPWA()">
          <i class="fa-solid fa-download me-1"></i>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
        </button>
        <button class="install-pwa-btn install-pwa-btn-secondary" onclick="closeInstallBanner()">
          –ü–æ–∑–∂–µ
        </button>
      </div>
    </div>
  {% endif %}
  
  <!-- Footer -->
  <footer class="site-footer">
    <div class="container">
      <div class="row">
        <div class="col-md-3 mb-4">
          <h5 class="footer-title">–û –ø—Ä–æ–µ–∫—Ç–µ</h5>
          <p class="footer-text">FinQuest ‚Äî —ç—Ç–æ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ –≤ –∏–≥—Ä–æ–≤–æ–π —Ñ–æ—Ä–º–µ. –£—á–∏—Ç–µ—Å—å, —Ä–∞–∑–≤–∏–≤–∞–π—Ç–µ—Å—å –∏ –¥–æ—Å—Ç–∏–≥–∞–π—Ç–µ —Å–≤–æ–∏—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π!</p>
        </div>
        <div class="col-md-3 mb-4">
          <h5 class="footer-title">–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h5>
          <ul class="footer-list">
            <li><i class="fa-solid fa-check me-2"></i>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —É—Ä–æ–∫–∏</li>
            <li><i class="fa-solid fa-check me-2"></i>–°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</li>
            <li><i class="fa-solid fa-check me-2"></i>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</li>
            <li><i class="fa-solid fa-check me-2"></i>–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Ç–∞—Ç—å–∏</li>
          </ul>
        </div>
        <div class="col-md-3 mb-4">
          <h5 class="footer-title">–ö–æ–º–∞–Ω–¥–∞</h5>
          <p class="footer-text mb-2"><i class="fa-solid fa-users me-2" style="color: #667eea;"></i><strong>–ö–æ–º–∞–Ω–¥–∞ "–î–∂—É–Ω—Ü—ã"</strong></p>
          <p class="footer-text mb-2"><i class="fa-solid fa-trophy me-2" style="color: #667eea;"></i>–ò–¢-–°–ø—Ä–∏–Ω—Ç 2025</p>
          <p class="footer-text mb-2"><i class="fa-solid fa-building me-2" style="color: #667eea;"></i>–ö–µ–π—Å –æ—Ç –∫–æ–º–ø–∞–Ω–∏–∏<br>"–ü—è—Ç—ã–π —ç–ª–µ–º–µ–Ω—Ç"</p>
        </div>
        <div class="col-md-3 mb-4">
          <h5 class="footer-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h5>
          <ul class="footer-list">
            <li><i class="fa-solid fa-envelope me-2"></i>info@finquest.ru</li>
            <li><i class="fa-solid fa-globe me-2"></i>www.finquest.ru</li>
          </ul>
          <div class="social-links mt-3">
            <a href="#" class="social-link" title="Telegram"><i class="fa-brands fa-telegram"></i></a>
            <a href="#" class="social-link" title="VK"><i class="fa-brands fa-vk"></i></a>
          </div>
        </div>
      </div>
      <div class="footer-bottom text-center mt-4 pt-4">
        <p class="mb-0">&copy; 2025 FinQuest by –ö–æ–º–∞–Ω–¥–∞ "–î–∂—É–Ω—Ü—ã". –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
      </div>
    </div>
  </footer>
  
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
  <div class="modal fade" id="achievementModal" tabindex="-1" aria-labelledby="achievementModalLabel" aria-hidden="true" data-bs-backdrop="false">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content achievement-modal-content">
        <div class="modal-body text-center p-4">
          <div class="achievement-celebration">
            <div class="achievement-icon-large mb-3" id="achievementIconContainer">
              <i class="fa-solid fa-trophy" id="achievementIcon"></i>
            </div>
            <h4 class="achievement-title mb-2" id="achievementTitle">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h4>
            <p class="achievement-description mb-3" id="achievementDescription">–í—ã –ø–æ–ª—É—á–∏–ª–∏ –Ω–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ!</p>
            <div class="achievement-rarity-badge mb-3" id="achievementRarity"></div>
            <button type="button" class="btn btn-primary btn-lg" onclick="closeAchievementModal()">
              <i class="fa-solid fa-check me-2"></i>–£—Ä–∞! üéâ
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
  <div id="confetti-container"></div>
  
  <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
  
  <script>
    // –°–∏—Å—Ç–µ–º–∞ —Ç–µ–º
    function toggleTheme() {
      const body = document.body;
      const themeIcon = document.getElementById('theme-icon');
      const mobileThemeIcon = document.getElementById('mobile-theme-icon');
      const mobileThemeToggle = document.getElementById('mobile-theme-toggle');
      
      if (body.classList.contains('dark-theme')) {
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É
        body.classList.remove('dark-theme');
        if (themeIcon) themeIcon.className = 'fa-solid fa-moon';
        if (mobileThemeIcon) mobileThemeIcon.className = 'fa-solid fa-moon';
        if (mobileThemeToggle) mobileThemeToggle.checked = false;
        localStorage.setItem('theme', 'light');
      } else {
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Ç–µ–º–Ω—É—é —Ç–µ–º—É
        body.classList.add('dark-theme');
        if (themeIcon) themeIcon.className = 'fa-solid fa-sun';
        if (mobileThemeIcon) mobileThemeIcon.className = 'fa-solid fa-sun';
        if (mobileThemeToggle) mobileThemeToggle.checked = true;
        localStorage.setItem('theme', 'dark');
      }
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã –≤ –º–æ–±–∏–ª—å–Ω–æ–º –º–µ–Ω—é
    function updateMobileThemeToggle() {
      const body = document.body;
      const mobileThemeToggle = document.getElementById('mobile-theme-toggle');
      const mobileThemeIcon = document.getElementById('mobile-theme-icon');
      
      if (mobileThemeToggle) {
        mobileThemeToggle.checked = body.classList.contains('dark-theme');
      }
      if (mobileThemeIcon) {
        mobileThemeIcon.className = body.classList.contains('dark-theme') 
          ? 'fa-solid fa-sun' 
          : 'fa-solid fa-moon';
      }
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
      const savedTheme = localStorage.getItem('theme');
      const themeIcon = document.getElementById('theme-icon');
      const mobileThemeIcon = document.getElementById('mobile-theme-icon');
      const mobileThemeToggle = document.getElementById('mobile-theme-toggle');
      
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-theme');
        if (themeIcon) {
          themeIcon.className = 'fa-solid fa-sun';
        }
        if (mobileThemeIcon) {
          mobileThemeIcon.className = 'fa-solid fa-sun';
        }
        if (mobileThemeToggle) {
          mobileThemeToggle.checked = true;
        }
      } else {
        if (mobileThemeToggle) {
          mobileThemeToggle.checked = false;
        }
      }
    });
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
    function showAchievement(achievementData) {
      const modal = new bootstrap.Modal(document.getElementById('achievementModal'), {
        backdrop: false,
        keyboard: true
      });
      const iconContainer = document.getElementById('achievementIconContainer');
      const title = document.getElementById('achievementTitle');
      const description = document.getElementById('achievementDescription');
      const rarity = document.getElementById('achievementRarity');
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º SVG –∏–∫–æ–Ω–∫—É –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
      let svgFile = 'trophy';
      const name = achievementData.name || '';
      
      if (name.includes('–ü–µ—Ä–≤—ã–π —à–∞–≥')) svgFile = 'first_step';
      else if (name.includes('–û—Ç–∫—Ä—ã—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å')) svgFile = 'unlock_literacy';
      else if (name.includes('–æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–Ω–∞–Ω–∏–π')) svgFile = 'master_basics';
      else if (name.includes('–±–∞–∑–æ–≤—ã—Ö –Ω–∞–≤—ã–∫–æ–≤')) svgFile = 'master_skills';
      else if (name.includes('–±—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è')) svgFile = 'master_budget';
      else if (name.includes('—Å–±–µ—Ä–µ–∂–µ–Ω–∏–π')) svgFile = 'master_savings';
      else if (name.includes('–∫—Ä–µ–¥–∏—Ç–æ–≤')) svgFile = 'master_credit';
      else if (name.includes('–±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —É—Å–ª—É–≥')) svgFile = 'master_banking';
      else if (name.includes('–∞–∫—Ü–∏–æ–Ω–µ—Ä–∏—è') || name.includes('–ê–∫—Ü–∏')) svgFile = 'master_stocks';
      else if (name.includes('–¥–æ–ª–≥–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤') || name.includes('–û–±–ª–∏–≥–∞—Ü–∏')) svgFile = 'master_bonds';
      else if (name.includes('–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏')) svgFile = 'master_realestate';
      else if (name.includes('–∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç')) svgFile = 'master_crypto';
      else if (name.includes('–ø–µ–Ω—Å–∏–æ–Ω')) svgFile = 'master_retirement';
      else if (name.includes('–Ω–∞–ª–æ–≥')) svgFile = 'master_taxes';
      else if (name.includes('—Å—Ç—Ä–∞—Ö–æ–≤')) svgFile = 'master_insurance';
      else if (name.includes('—Ü–µ–ª–µ–π') || name.includes('–ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏')) svgFile = 'master_goals';
      else if (name.includes('–º–æ—à–µ–Ω–Ω')) svgFile = 'master_fraud';
      else if (name.includes('–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏') || name.includes('–¥–∞–Ω–Ω—ã—Ö')) svgFile = 'master_privacy';
      else if (name.includes('—é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π')) svgFile = 'master_legal';
      else if (name.includes('—Ä–∏—Å–∫')) svgFile = 'master_risks';
      else if (name.includes('–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è')) svgFile = 'master_planning';
      else if (name.includes('—Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏')) svgFile = 'master_security';
      else if (name.includes('—Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏')) svgFile = 'master_financial';
      else if (achievementData.category === 'streak') svgFile = 'streak';
      else if (achievementData.category === 'points') svgFile = 'points';
      else if (achievementData.category === 'coins') svgFile = 'coins';
      else if (achievementData.rarity === 'legendary') svgFile = 'legendary';
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º SVG –∏–∫–æ–Ω–∫—É
      iconContainer.innerHTML = `<img src="/static/images/achievements/${svgFile}.svg" alt="${achievementData.name}" style="width: 100px; height: 100px; filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3));">`;
      
      title.textContent = `üéâ ${achievementData.name}`;
      description.textContent = achievementData.description;
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–¥–∫–æ—Å—Ç—å
      rarity.textContent = achievementData.rarity_display;
      rarity.className = `achievement-rarity-badge rarity-${achievementData.rarity}`;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
      modal.show();
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
      createConfetti();
    }
    
    function closeAchievementModal() {
      const modal = bootstrap.Modal.getInstance(document.getElementById('achievementModal'));
      if (modal) {
        modal.hide();
      }
    }
    
    function createConfetti() {
      const container = document.getElementById('confetti-container');
      const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3'];
      
      // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
      container.innerHTML = '';
      
      // –°–æ–∑–¥–∞–µ–º 50 –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.animationDelay = Math.random() * 3 + 's';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.width = (Math.random() * 10 + 5) + 'px';
        confetti.style.height = confetti.style.width;
        
        container.appendChild(confetti);
        
        // –£–¥–∞–ª—è–µ–º –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
          if (confetti.parentNode) {
            confetti.parentNode.removeChild(confetti);
          }
        }, 3000);
      }
    }
    
    // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
    function toggleMobileMenu() {
      const menu = document.getElementById('mobileMenu');
      const overlay = document.getElementById('mobileMenuOverlay');
      
      if (menu && overlay) {
        menu.classList.toggle('active');
        overlay.classList.toggle('active');
        
        // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É body –∫–æ–≥–¥–∞ –º–µ–Ω—é –æ—Ç–∫—Ä—ã—Ç–æ
        if (menu.classList.contains('active')) {
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = '';
        }
      }
    }
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    document.addEventListener('click', function(event) {
      const menu = document.getElementById('mobileMenu');
      const overlay = document.getElementById('mobileMenuOverlay');
      const toggle = document.querySelector('.mobile-menu-toggle');
      
      if (menu && overlay && menu.classList.contains('active')) {
        if (!menu.contains(event.target) && event.target !== toggle) {
          toggleMobileMenu();
        }
      }
    });
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PWA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    let deferredPWAPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPWAPrompt = e;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –º–µ–Ω—é
      const menuBtn = document.getElementById('installPWAMenuBtn');
      if (menuBtn) {
        menuBtn.style.display = 'flex';
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ—Ç–∫–ª–æ–Ω—è–ª –µ–≥–æ —Ä–∞–Ω–µ–µ
      const bannerDismissed = localStorage.getItem('pwa_banner_dismissed');
      const bannerDismissedTime = localStorage.getItem('pwa_banner_dismissed_time');
      const now = Date.now();
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π –ø–æ—Å–ª–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
      if (!bannerDismissed || (bannerDismissedTime && now - bannerDismissedTime > 7 * 24 * 60 * 60 * 1000)) {
        setTimeout(() => {
          const banner = document.getElementById('installPWABanner');
          if (banner) {
            banner.classList.add('show');
          }
        }, 3000); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
      }
    });
    
    async function installPWA() {
      if (!deferredPWAPrompt) {
        // –ï—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç PWA —É—Å—Ç–∞–Ω–æ–≤–∫—É
        showManualInstallInstructions();
        return;
      }
      
      const banner = document.getElementById('installPWABanner');
      if (banner) {
        banner.classList.remove('show');
      }
      
      deferredPWAPrompt.prompt();
      const { outcome } = await deferredPWAPrompt.userChoice;
      
      if (outcome === 'accepted') {
        console.log('PWA —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –º–µ–Ω—é
        const menuBtn = document.getElementById('installPWAMenuBtn');
        if (menuBtn) {
          menuBtn.style.display = 'none';
        }
      }
      
      deferredPWAPrompt = null;
    }
    
    async function installPWAFromMenu() {
      toggleMobileMenu(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
      await installPWA();
    }
    
    function closeInstallBanner() {
      const banner = document.getElementById('installPWABanner');
      if (banner) {
        banner.classList.remove('show');
        localStorage.setItem('pwa_banner_dismissed', 'true');
        localStorage.setItem('pwa_banner_dismissed_time', Date.now());
      }
    }
    
    function showManualInstallInstructions() {
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
      const isAndroid = /Android/.test(navigator.userAgent);
      
      let message = '';
      if (isIOS) {
        message = '–ß—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ iOS:\n\n' +
                  '1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" (–∫–≤–∞–¥—Ä–∞—Ç —Å–æ —Å—Ç—Ä–µ–ª–∫–æ–π)\n' +
                  '2. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ "–ù–∞ —ç–∫—Ä–∞–Ω ¬´–î–æ–º–æ–π¬ª"\n' +
                  '3. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å"';
      } else if (isAndroid) {
        message = '–ß—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Android:\n\n' +
                  '1. –û—Ç–∫—Ä–æ–π—Ç–µ –º–µ–Ω—é –±—Ä–∞—É–∑–µ—Ä–∞ (—Ç—Ä–∏ —Ç–æ—á–∫–∏)\n' +
                  '2. –í—ã–±–µ—Ä–∏—Ç–µ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" –∏–ª–∏ "–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω"\n' +
                  '3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É';
      } else {
        message = '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É PWA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.\n\n' +
                  '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç –≤ Chrome –∏–ª–∏ Safari.';
      }
      
      alert(message);
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    window.addEventListener('appinstalled', () => {
      console.log('FinQuest PWA —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ! üéâ');
      const banner = document.getElementById('installPWABanner');
      if (banner) {
        banner.classList.remove('show');
      }
      const menuBtn = document.getElementById('installPWAMenuBtn');
      if (menuBtn) {
        menuBtn.style.display = 'none';
      }
    });
    
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ prompt —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–∑ –º–µ–Ω—é
    function showInstallPrompt() {
      if (deferredPWAPrompt) {
        installPWA();
      } else {
        showManualInstallInstructions();
      }
    }
  </script>
  
  {% block extra_js %}{% endblock %}
</body>
</html>