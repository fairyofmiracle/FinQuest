{% extends 'base.html' %}
{% block title %}FinQuest — Главная{% endblock %}

{% block content %}
{% if is_first_visit %}
<div id="first-visit-trigger" style="display: none;"></div>
{% endif %}
<!-- Статус пользователя -->
<div class="user-card mb-4">
  <div class="card">
    <div class="card-body">
      <div class="row align-items-center">
        <div class="col-auto">
          {% if user.get_avatar_display %}
            <img src="{{ user.get_avatar_display }}" class="shadow {{ user.get_avatar_border_class }}" width="80" height="80" alt="Аватар" style="border-radius: 16px; object-fit: cover;">
          {% else %}
            <div class="bg-primary text-white d-flex align-items-center justify-content-center shadow {{ user.get_avatar_border_class }}"
                 style="width:80px; height:80px; font-size:26px; font-weight:bold; border-radius: 16px;">
              {{ user.username|first|upper }}
            </div>
          {% endif %}
        </div>
        <div class="col">
          <h5 class="mb-1">{{ user.get_full_name|default:user.username }}</h5>
          <div class="d-flex align-items-center mb-2">
            <span class="text-muted small me-2">{{ user.get_level_title }} • Уровень {{ user.level_number }}</span>
            <div class="progress flex-grow-1" style="height: 6px; max-width: 100px;">
              <div class="progress-bar bg-gradient" role="progressbar" style="width: {{ user.level_progress }}%;"></div>
            </div>
          </div>
          <div class="d-flex gap-2">
            <span class="badge bg-primary"><i class="fa-solid fa-star me-1"></i>{{ user.points }}</span>
            <span class="badge bg-warning text-white"><i class="fa-solid fa-coins me-1"></i>{{ user.coins }}</span>
            <span class="badge bg-success"><i class="fa-solid fa-trophy me-1"></i>{{ user.achievements_count }}</span>
          </div>
        </div>
        <div class="col-auto">
          <a href="{% url 'profile' %}" class="btn btn-outline-primary btn-sm">
            <i class="fa-solid fa-cog me-1"></i>Настройки
          </a>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Основные категории обучения -->
<h5 class="mb-4 section-title"><i class="fa-solid fa-graduation-cap"></i> Категории обучения</h5>

<!-- 4 основные категории в виде карточек -->
<div class="row g-4 mb-5">
  <!-- Основы финансов -->
  <div class="col-lg-3 col-md-6">
    <div class="main-category-card" onclick="location.href='{% url 'category_detail' 'basics' %}'">
      <div class="main-category-icon">
        <i class="fa-solid fa-piggy-bank"></i>
      </div>
      <h3 class="main-category-title">{{ categories.basics.name }}</h3>
      <p class="main-category-description">Изучите базовые принципы управления деньгами и начните свой путь к финансовой грамотности</p>
      <div class="main-category-stats">
        <div class="main-category-progress">
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: {{ categories.basics.progress_percent }}%;"></div>
          </div>
        </div>
        <div class="main-category-percent">{{ categories.basics.progress_percent }}%</div>
      </div>
      <button class="main-category-button">
        <i class="fa-solid fa-play me-2"></i>Изучать основы
      </button>
    </div>
  </div>

  <!-- Безопасность -->
  <div class="col-lg-3 col-md-6">
    <div class="main-category-card" onclick="location.href='{% url 'category_detail' 'security' %}'">
      <div class="main-category-icon">
        <i class="fa-solid fa-shield-halved"></i>
      </div>
      <h3 class="main-category-title">{{ categories.security.name }}</h3>
      <p class="main-category-description">Защитите себя от мошенников и финансовых рисков в цифровом мире</p>
      <div class="main-category-stats">
        <div class="main-category-progress">
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: {{ categories.security.progress_percent }}%;"></div>
          </div>
        </div>
        <div class="main-category-percent">{{ categories.security.progress_percent }}%</div>
      </div>
      <button class="main-category-button">
        <i class="fa-solid fa-shield me-2"></i>Защититься
      </button>
    </div>
  </div>

  <!-- Инвестиции -->
  <div class="col-lg-3 col-md-6">
    <div class="main-category-card" onclick="location.href='{% url 'category_detail' 'investments' %}'">
      <div class="main-category-icon">
        <i class="fa-solid fa-chart-line"></i>
      </div>
      <h3 class="main-category-title">{{ categories.investments.name }}</h3>
      <p class="main-category-description">Научитесь приумножать свои сбережения и строить капитал</p>
      <div class="main-category-stats">
        <div class="main-category-progress">
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: {{ categories.investments.progress_percent }}%;"></div>
          </div>
        </div>
        <div class="main-category-percent">{{ categories.investments.progress_percent }}%</div>
      </div>
      <button class="main-category-button">
        <i class="fa-solid fa-chart-line me-2"></i>Инвестировать
      </button>
    </div>
  </div>

  <!-- Планирование -->
  <div class="col-lg-3 col-md-6">
    <div class="main-category-card" onclick="location.href='{% url 'category_detail' 'planning' %}'">
      <div class="main-category-icon">
        <i class="fa-solid fa-bullseye"></i>
      </div>
      <h3 class="main-category-title">{{ categories.planning.name }}</h3>
      <p class="main-category-description">Достигайте своих финансовых целей с помощью правильного планирования</p>
      <div class="main-category-stats">
        <div class="main-category-progress">
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: {{ categories.planning.progress_percent }}%;"></div>
          </div>
        </div>
        <div class="main-category-percent">{{ categories.planning.progress_percent }}%</div>
      </div>
      <button class="main-category-button">
        <i class="fa-solid fa-bullseye me-2"></i>Планировать
      </button>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
{% load static %}
<!-- tutorial.js уже подключен в base.html -->
<script>
// Инициализация туториала для новых пользователей
document.addEventListener('DOMContentLoaded', function() {
    const firstVisitTrigger = document.getElementById('first-visit-trigger');
    
    if (firstVisitTrigger) {
        const tutorialCompleted = localStorage.getItem('finquest_tutorial_completed');
        
        if (!tutorialCompleted && typeof FinQuestTutorial !== 'undefined') {
            window.tutorialInstance = new FinQuestTutorial();
            tutorialInstance.start();
        }
    }
});
</script>
{% endblock %}