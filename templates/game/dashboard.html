{% extends 'base.html' %}
{% block title %}FinQuest — Главная{% endblock %}

{% block content %}
{% if is_first_visit %}
<div id="first-visit-trigger" style="display: none;"></div>
{% endif %}
<!-- Статус пользователя -->
<div class="user-card mb-4">
  <div class="card">
    <div class="card-body">
      <div class="row align-items-center">
        <div class="col-auto">
          {% if user.avatar %}
            <img src="{{ user.avatar.url }}" class="rounded-circle shadow" width="60" height="60" alt="Аватар">
          {% else %}
            <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center shadow"
                 style="width:60px; height:60px; font-size:20px; font-weight:bold;">
              {{ user.username|first|upper }}
            </div>
          {% endif %}
        </div>
        <div class="col">
          <h5 class="mb-1">{{ user.get_full_name|default:user.username }}</h5>
          <div class="d-flex align-items-center mb-2">
            <span class="text-muted small me-2">{{ user.get_level_title }} • Уровень {{ user.level_number }}</span>
            <div class="progress flex-grow-1" style="height: 6px; max-width: 100px;">
              <div class="progress-bar bg-gradient" role="progressbar" style="width: {{ user.level_progress }}%;"></div>
            </div>
          </div>
          <div class="d-flex gap-2">
            <span class="badge bg-primary"><i class="fa-solid fa-star me-1"></i>{{ user.points }}</span>
            <span class="badge bg-warning text-dark"><i class="fa-solid fa-coins me-1"></i>{{ user.coins }}</span>
            <span class="badge bg-success"><i class="fa-solid fa-trophy me-1"></i>{{ user.achievements_count }}</span>
          </div>
        </div>
        <div class="col-auto">
          <a href="{% url 'profile' %}" class="btn btn-outline-primary btn-sm">
            <i class="fa-solid fa-cog me-1"></i>Настройки
          </a>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Темы -->
<h5 class="section-title"><i class="fa-solid fa-shield-halved"></i> Темы</h5>
{% for topic in topics %}
  <a href="{% url 'topic_levels' topic.id %}" class="text-decoration-none">
    <div class="card mb-3">
      <div class="card-body py-2">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <h6 class="mb-1">{{ topic.name }}</h6>
            <p class="text-muted small mb-0">{{ topic.description|truncatewords:6 }}</p>
          </div>
          <span class="badge bg-primary">{{ topic.progress.percent }}%</span>
        </div>
        <div class="progress mt-2" style="height: 5px;">
          <div class="progress-bar" role="progressbar" style="width: {{ topic.progress.percent }}%;"></div>
        </div>
      </div>
    </div>
  </a>
{% empty %}
  <p class="text-muted">Нет тем.</p>
{% endfor %}

{% endblock %}