{% extends 'base.html' %}
{% load static %}

{% block title %}{{ topic.name }} ‚Äî FinQuest{% endblock %}
{% block page_title %}<i class="fa-solid fa-book-open me-2"></i>{{ topic.name }}{% endblock %}

{% block content %}
<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–µ–º—ã -->
<div class="topic-header mb-4 fade-in">
  <div class="card">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <h5 class="mb-2"><i class="fa-solid fa-book-open me-2"></i>{{ topic.name }}</h5>
          <p class="text-muted small mb-0">{{ topic.description|default:"–ü—Ä–æ–π–¥–∏—Ç–µ –≤—Å–µ —É—Ä–æ–≤–Ω–∏ —Ç–µ–º—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥" }}</p>
        </div>
        <a href="{% url 'categories' %}" class="btn btn-sm btn-outline-primary desktop-only">
          <i class="fa-solid fa-arrow-left me-1"></i>–ù–∞–∑–∞–¥
        </a>
      </div>
    </div>
  </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ —É—Ä–æ–≤–Ω–µ–π -->
{% if levels %}
<div class="levels-list mb-4">
  {% for level in levels %}
    <a href="{% url 'level_play' level.id %}" class="card mb-3 level-card-link haptic-light slide-in-up" style="text-decoration: none; color: inherit;">
      <div class="card-body">
        <div class="d-flex align-items-start mb-2">
          <!-- –ò–∫–æ–Ω–∫–∞ —É—Ä–æ–≤–Ω—è (—Å–∫—Ä—ã—Ç–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö) -->
          <div class="level-icon-wrapper desktop-only me-3">
            <div class="level-mini-icon">
              <img src="{% static 'images/topics/' %}{% if '–ë—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ' in topic.name %}budgeting{% elif '–°–±–µ—Ä–µ–∂–µ–Ω–∏—è' in topic.name or '–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è' in topic.name %}savings{% elif '–ö—Ä–µ–¥–∏—Ç' in topic.name or '–∑–∞–π–º' in topic.name %}credit{% elif '–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ' in topic.name %}banking{% elif '–ê–∫—Ü–∏–∏' in topic.name %}stocks{% elif '–û–±–ª–∏–≥–∞—Ü–∏–∏' in topic.name %}bonds{% elif '–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å' in topic.name %}realestate{% elif '–ö—Ä–∏–ø—Ç–æ' in topic.name %}crypto{% elif '–ü–µ–Ω—Å–∏–æ–Ω' in topic.name %}retirement{% elif '–ù–∞–ª–æ–≥' in topic.name %}taxes{% elif '–°—Ç—Ä–∞—Ö–æ–≤–∞' in topic.name %}insurance{% elif '—Ü–µ–ª' in topic.name %}goals{% elif '–ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ' in topic.name %}fraud{% elif '–ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö' in topic.name or '–¥–∞–Ω–Ω—ã—Ö' in topic.name %}privacy{% elif '–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è' in topic.name %}legal{% elif '—Ä–∏—Å–∫' in topic.name %}risks{% else %}budgeting{% endif %}.svg"
                   alt="{{ topic.name }}" />
            </div>
          </div>
          
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between align-items-start mb-1">
              <h6 class="mb-0">{{ level.title }}</h6>
              <i class="fa-solid fa-chevron-right ms-2 text-muted" style="font-size: 0.9rem;"></i>
            </div>
            <small class="text-muted d-block mb-2">{{ level.description|truncatewords:12 }}</small>
            
            <!-- –ë–µ–π–¥–∂–∏ -->
            <div class="d-flex flex-wrap gap-1">
              <!-- –°—Ç–∞—Ç—É—Å -->
              {% if level.user_progress.completed %}
                <span class="badge bg-success">
                  <i class="fa-solid fa-check-circle me-1"></i>–ü—Ä–æ–π–¥–µ–Ω {{ level.user_progress.best_score }}%
                </span>
              {% else %}
                <span class="badge bg-primary">
                  <i class="fa-solid fa-play me-1"></i>–ù–∞—á–∞—Ç—å
                </span>
              {% endif %}
              
              <!-- –°–ª–æ–∂–Ω–æ—Å—Ç—å -->
              <span class="badge bg-secondary">
                {% if level.difficulty == 1 %}
                  <i class="fa-solid fa-star me-1"></i>–õ–µ–≥–∫–æ
                {% elif level.difficulty == 2 %}
                  <i class="fa-solid fa-star me-1"></i><i class="fa-solid fa-star me-1"></i>–°—Ä–µ–¥–Ω–µ
                {% else %}
                  <i class="fa-solid fa-star me-1"></i><i class="fa-solid fa-star me-1"></i><i class="fa-solid fa-star me-1"></i>–°–ª–æ–∂–Ω–æ
                {% endif %}
              </span>
              
              <!-- –ù–∞–≥—Ä–∞–¥—ã -->
              <span class="badge bg-warning text-dark">
                <i class="fa-solid fa-coins me-1"></i>{{ level.reward_coins }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </a>
  {% endfor %}
</div>
{% else %}
  <div class="card">
    <div class="card-body text-center py-4">
      <div class="text-muted mb-2">üìö</div>
      <p class="text-muted mb-0">–í —ç—Ç–æ–π —Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç —É—Ä–æ–≤–Ω–µ–π.</p>
    </div>
  </div>
{% endif %}

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É—Ä–æ–≤–Ω–µ–π —Ç–µ–º—ã */
.topic-header .card {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.08);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
}

body.dark-theme .topic-header .card {
  background: #1e293b;
  border: 1px solid #475569;
}

.levels-list .card {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.08);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.level-card-link:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12) !important;
}

.level-card-link:active {
  transform: scale(0.98);
}

body.dark-theme .levels-list .card {
  background: linear-gradient(135deg, rgba(30, 41, 59, 0.98) 0%, rgba(51, 65, 85, 0.92) 100%);
  border: 1px solid #475569;
}

/* –ò–∫–æ–Ω–∫–∞ —É—Ä–æ–≤–Ω—è (—Ç–æ–ª—å–∫–æ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ) */
.level-mini-icon {
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
}

.level-mini-icon img {
  width: 40px;
  height: 40px;
  filter: brightness(0) invert(1);
  opacity: 0.9;
}

/* –ë–µ–π–¥–∂–∏ */
.badge {
  font-size: 0.75rem;
  padding: 0.35rem 0.65rem;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
.fade-in {
  animation: fadeIn 0.3s ease;
}

.slide-in-up {
  animation: slideInUp 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
@media (max-width: 768px) {
  /* –°–∫—Ä—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
  body.mobile-view .level-icon-wrapper {
    display: none !important;
  }
  
  body.mobile-view .desktop-only {
    display: none !important;
  }
  
  body.mobile-view .topic-header .card,
  body.mobile-view .levels-list .card {
    border-radius: 16px;
  }
  
  body.mobile-view .card-body {
    padding: 1rem;
  }
  
  body.mobile-view h5 {
    font-size: 1.1rem;
  }
  
  body.mobile-view h6 {
    font-size: 1rem;
  }
  
  body.mobile-view .badge {
    font-size: 0.7rem;
    padding: 0.3rem 0.5rem;
  }
  
  body.mobile-view .level-card-link:hover {
    transform: none;
  }
  
  body.mobile-view .level-card-link:active {
    transform: scale(0.98);
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // –ó–∞–¥–µ—Ä–∂–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
  document.querySelectorAll('.slide-in-up').forEach((el, index) => {
    el.style.animationDelay = `${index * 0.05}s`;
  });
});
</script>
{% endblock %}